{% set map = salt['grains.filter_by']({
    'Debian': {
        'pkgs': [
            'libguestfs0',
            'libguestfs-tools',
            'libvirt0',
            'qemu-kvm',
        ],

        {% if grains['os'] is 'Ubuntu' -%}
        'service': 'libvirt-bin',
        {% else %}
        'service': 'libvirtd', 
        {% endif -%}       
    },
    'RedHat': {
        'pkgs': [
            'libguestfs',
            'libvirt',
            'qemu-kvm',
        ],
        'service': 'libvirtd',
    },
    'Arch': {
        'pkgs': [
            'libguestfs',
            'libvirt',
            'qemu',
        ],
        'service': 'libvirtd',
    },
}, merge=salt['pillar.get']('libvirt:lookup')) %}
